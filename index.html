<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Gooldbook</title>
    <style>
        body { background-color: #e9ebee; font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .nav { background: #3b5998; color: white; padding: 15px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 100; }
        .container { max-width: 500px; margin: auto; }
        .card { background: white; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 4px; }
        .user { color: #365899; font-weight: bold; }
        .post-img { width: 100%; margin-top: 10px; border-radius: 4px; }
        .btn { background: #4267b2; color: white; border: none; padding: 10px; cursor: pointer; width: 100%; font-weight: bold; }
        #loader { text-align: center; padding: 20px; color: #666; }
    </style>
</head>
<body>

<div class="nav">theGooldbook</div>

<div class="container">
    <div class="card">
        <input type="text" id="user" placeholder="Your Name" style="width:95%; padding:8px; margin-bottom:10px;">
        <textarea id="msg" placeholder="What's on your mind?" style="width:95%; padding:8px; margin-bottom:10px;"></textarea>
        <button class="btn" onclick="upload()">Post</button>
    </div>

    <div id="loader">Checking for posts...</div>
    <div id="feed"></div>
</div>

<script>
    // --- STEP 1: PASTE YOUR NEW URL HERE ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbya9m4KXIg2m73ryT3dEEEauRra5HskeL96siTWCCqHL9QuKclVx1Cug-JHvp8Ir_f3/exec";

    async function loadFeed() {
        const loader = document.getElementById('loader');
        const feed = document.getElementById('feed');
        try {
            const res = await fetch(SCRIPT_URL);
            const posts = await res.json();
            
            loader.style.display = 'none';
            if (posts.length === 0) {
                feed.innerHTML = "No posts found yet.";
                return;
            }

            feed.innerHTML = posts.map(p => `
                <div class="card">
                    <div class="user">${p.user}</div>
                    <div style="font-size:12px; color:#999;">${new Date(p.timestamp).toLocaleString()}</div>
                    <p>${p.message}</p>
                    ${p.image ? `<img src="${p.image}" class="post-img">` : ''}
                </div>
            `).join('');
        } catch (e) {
            loader.innerHTML = "Error loading feed. Check your Script URL.";
            console.error(e);
        }
    }

    async function upload() {
        const u = document.getElementById('user').value;
        const m = document.getElementById('msg').value;
        if (!u || !m) return alert("Fill everything!");

        const payload = { action: 'post', username: u, message: m };
        
        // Show loading state
        document.getElementById('feed').innerHTML = "Saving post...";
        
        await fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(payload)
        });

        // Wait 2 seconds for Google to process, then reload
        setTimeout(() => {
            document.getElementById('msg').value = "";
            loadFeed();
        }, 2000);
    }

    // Run on start
    loadFeed();
</script>
</body>
</html>
