<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>theGooldbook</title>
  <style>
    /* Classic Facebook Mobile Aesthetic (circa 2011) */
    body { 
      background-color: #e9ebee; 
      color: #1c1e21; 
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; 
      margin: 0; 
      padding-bottom: 50px; 
    }
    
    /* Glossy Blue Header Bar */
    .nav { 
      background: #4e69a2; /* Fallback */
      background: linear-gradient(#4e69a2, #3b5998); 
      border-bottom: 1px solid #29487d; 
      height: 44px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: sticky; 
      top: 0; 
      z-index: 100;
      box-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    
    .nav-title { 
      font-size: 20px; 
      font-weight: bold; 
      color: white; 
      text-shadow: 0 -1px 0 rgba(0,0,0,0.5);
      letter-spacing: -0.5px;
    }

    .container { max-width: 500px; margin: 0 auto; padding: 10px; }

    /* Composer and Post Cards */
    .card { 
      background: white; 
      border: 1px solid #bcc0c4; 
      border-radius: 3px; 
      padding: 10px; 
      margin-bottom: 10px; 
    }

    .section-header { 
      font-size: 11px; 
      font-weight: bold; 
      color: #4b4f56; 
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    input[type="text"], textarea { 
      width: 100%; 
      border: 1px solid #dddfe2; 
      padding: 10px; 
      box-sizing: border-box; 
      font-size: 14px; 
      margin-bottom: 8px; 
      border-radius: 4px;
      -webkit-appearance: none;
    }
    
    /* Styled Buttons */
    .btn { 
      background: linear-gradient(#5f78ab, #3b5998);
      border: 1px solid #29487d; 
      color: white; 
      padding: 8px 16px; 
      font-size: 13px; 
      font-weight: bold; 
      border-radius: 3px;
      text-shadow: 0 -1px 0 rgba(0,0,0,0.3);
      cursor: pointer;
    }
    .btn:active { background: #29487d; }
    .btn:disabled { background: #9cb4d8; border-color: #9cb4d8; }

    .btn-refresh { 
      background: #f5f6f7; 
      border: 1px solid #ccd0d5; 
      color: #4b4f56; 
      width: 100%; 
      margin-bottom: 15px;
      text-shadow: none;
      padding: 10px;
    }

    /* Post Layout */
    .post-user { color: #3b5998; font-weight: bold; font-size: 14px; }
    .post-date { color: #90949c; font-size: 11px; margin-bottom: 8px; }
    .post-msg { font-size: 14px; line-height: 1.4; margin: 10px 0; word-wrap: break-word; }
    .post-img { 
      width: calc(100% + 20px); 
      margin-left: -10px; 
      border-top: 1px solid #e9ebee; 
      border-bottom: 1px solid #e9ebee; 
      display: block; 
    }

    /* Footer Social Bar */
    .post-footer { 
      border-top: 1px solid #f2f2f2; 
      padding-top: 8px; 
      margin-top: 10px;
      display: flex;
      gap: 15px;
    }
    .social-btn { color: #7f7f7f; font-size: 12px; font-weight: bold; text-decoration: none; cursor: pointer; }

    /* Spinner */
    .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #3b5998; border-radius: 50%; width: 24px; height: 24px; animation: spin 0.8s linear infinite; margin: 15px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .hidden { display: none; }
  </style>
</head>
<body>

  <div class="nav">
    <div class="nav-title">theGooldbook</div>
  </div>

  <div class="container">
    <div class="card">
      <div class="section-header">Status Update</div>
      <input type="text" id="user" placeholder="Your Name">
      <textarea id="msg" placeholder="What's on your mind?" rows="3"></textarea>
      <input type="file" id="file" accept="image/*" style="font-size: 12px; margin-bottom: 10px; width: 100%;">
      <div style="text-align: right;">
        <button id="btn" class="btn" onclick="upload()">Post</button>
      </div>
    </div>

    <button class="btn btn-refresh" onclick="load()">ðŸ”„ Check for New Posts</button>

    <div id="loader" class="spinner hidden"></div>

    <div id="feed"></div>
  </div>

  <script>
    // --- INSERT YOUR GOOGLE APPS SCRIPT URL HERE ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxwkf4KqZMcTeuRDqRjh9VM0Dw3qKYvOwQbwBDKRfcZ8tvOFGYfdlXiuaU3s1hpTemw/exec";

    async function load() {
      const loader = document.getElementById('loader');
      const feed = document.getElementById('feed');
      loader.classList.remove('hidden');
      
      try {
        const res = await fetch(SCRIPT_URL);
        const data = await res.json();
        
        feed.innerHTML = data.map(p => `
          <div class="card">
            <div class="post-user">${p.user}</div>
            <div class="post-date">${p.timestamp || 'Recently'}</div>
            <div class="post-msg">${p.message}</div>
            ${p.image ? `<img src="${p.image}" class="post-img">` : ""}
            <div class="post-footer">
               <span class="social-btn" onclick="alert('Liked!')">Like</span>
               <span class="social-btn">Comment</span>
               <span style="color: #90949c; font-size: 12px; font-weight: normal; margin-left: auto;">${p.likes || 0} Likes</span>
            </div>
          </div>
        `).join('');
      } catch (e) {
        feed.innerHTML = "<div class='card'>Could not connect to feed. Please check SCRIPT_URL or deployment settings.</div>";
      } finally {
        loader.classList.add('hidden');
      }
    }

    function upload() {
      const u = document.getElementById('user').value;
      const m = document.getElementById('msg').value;
      const f = document.getElementById('file').files[0];
      const btn = document.getElementById('btn');
      
      if(!u || !m) return alert("Missing name or message.");
      
      btn.disabled = true;
      document.getElementById('loader').classList.remove('hidden');

      const reader = new FileReader();
      reader.onload = async (e) => {
        const payload = {
          username: u,
          message: m,
          image: f ? e.target.result : ""
        };
        
        try {
          const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
          });
          document.getElementById('msg').value = "";
          document.getElementById('file').value = "";
          load();
        } catch (err) {
          alert("Error posting. Ensure Google Script is deployed as 'Anyone'.");
        } finally {
          btn.disabled = false;
        }
      };

      if(f) {
        reader.readAsDataURL(f); 
      } else {
        reader.onload(); 
      }
    }
    
    // Initial load
    window.onload = load;
  </script>
</body>
</html>
